set.seed(2457)
trainingtf = sample.int(2,size=length(edinburgh$stars),replace=TRUE,prob=c(0.7,0.3))
trainingx = edinburgh$text[trainingtf==1]
testx = edinburgh$text[trainingtf==2]
trainingy=rating[trainingtf==1]
testy = rating[trainingtf==2]
train.corpus <- VCorpus(VectorSource(trainingx))
train.corpus <- tm_map(train.corpus,content_transformer(tolower))
train.corpus <- tm_map(train.corpus,removePunctuation)
train.corpus <- tm_map(train.corpus,removeNumbers)
train.corpus <- tm_map(train.corpus,stripWhitespace)
train.corpus <- tm_map(train.corpus,removeWords,stopwords("english"))
training.dtm <- DocumentTermMatrix(train.corpus,control=list(stemming=TRUE))
traindict=findFreqTerms(training.dtm,100)
training.dtm <- training.dtm[,traindict]
training.dtm.df <- as.data.frame(inspect(training.dtm))
nbmodel <- naiveBayes(training.dtm.df,trainingy,laplace=1)
predictions <- predict(nbmodel,newdata=training.dtm.df,type="class")
train.cm <- confusionMatrix(predictions,trainingy)
test.corpus <- VCorpus(VectorSource(testx))
test.corpus <- tm_map(test.corpus,content_transformer(tolower))
test.corpus <- tm_map(test.corpus,removePunctuation)
test.corpus <- tm_map(test.corpus,removeNumbers)
test.corpus <- tm_map(test.corpus,stripWhitespace)
test.corpus <- tm_map(test.corpus,removeWords,stopwords("english"))
test.dtm <- DocumentTermMatrix(test.corpus,control=list(stemming=TRUE,dictionary=traindict))
test.dtm.df <- as.data.frame(inspect(test.dtm))
predictions.test <- predict(nbmodel,newdata=test.dtm.df,type="class")
test.cm <- confusionMatrix(predictions.test,testy)

new.corpus <- VCorpus(VectorSource(scottsdale$text))
new.corpus <- tm_map(new.corpus,content_transformer(tolower))
new.corpus <- tm_map(new.corpus,removePunctuation)
new.corpus <- tm_map(new.corpus,removeNumbers)
new.corpus <- tm_map(new.corpus,stripWhitespace)
new.corpus <- tm_map(new.corpus,removeWords,stopwords("english"))
new.dtm <- DocumentTermMatrix(new.corpus,control=list(stemming=TRUE,dictionary=traindict))
new.dtm.df <- as.data.frame(inspect(new.dtm))
predictions.new <- predict(nbmodel,newdata=new.dtm.df,type="class")
newy <- sapply(scottsdale$stars,f1)
newy <-as.factor(newy)
scottsdale.cm <- confusionMatrix(predictions.new,newy)
